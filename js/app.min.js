const divInstall=document.getElementById("installContainer"),butInstall=document.getElementById("butInstall");if(window.addEventListener("beforeinstallprompt",event=>{event.preventDefault(),window.deferredPrompt=event,divInstall.classList.toggle("hidden",!1)}),butInstall.addEventListener("click",async()=>{const promptEvent=window.deferredPrompt;if(!promptEvent)return;promptEvent.prompt();const result=await promptEvent.userChoice;window.deferredPrompt=null,divInstall.classList.toggle("hidden",!0)}),window.addEventListener("appinstalled",event=>{window.deferredPrompt=null}),"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js"),"http:"===window.location.protocol){const requireHTTPS=document.getElementById("requireHTTPS"),link=requireHTTPS.querySelector("a");link.href=window.location.href.replace("http://","https://"),requireHTTPS.classList.remove("hidden")}butInstall.addEventListener("click",async()=>{const promptEvent=window.deferredPrompt;if(!promptEvent)return;promptEvent.prompt();const result=await promptEvent.userChoice;window.deferredPrompt=null,divInstall.classList.toggle("hidden",!0)}),window.addEventListener("appinstalled",event=>{window.deferredPrompt=null});const vm=new Vue({el:"#app",data:{lang:"lt",title:"Todo app",todo:"",timeAdd:"",timeFin:"",flag:!1,index:0,placeholder:"Type here..",todoArray:[]},methods:{parser(){try{return JSON.parse(window.localStorage.getItem("todo-app"))}catch(e){window.localStorage.removeItem("todo-app"),window.location.reload()}},addTodo(){if(this.todo.trim().length>0){const values=[].concat.apply([],this.todoArray.filter(e=>isNaN(e.todo)).map(e=>e.todo));-1===values.indexOf(this.todo.trim())?(this.todoArray.push({todo:this.todo.replace(/,/g,".").trim(),done:!1,timeAdd:this.setTime()}),this.addToLocalStorage(),this.todo="",this.refresh()):(this.todo="",this.placeholder="Value already exists!")}else this.placeholder="Empty field!";window.scrollTo({top:0}),this.flag=!0},removeTodo(index,elem){this.todoArray.splice(index,1),this.addToLocalStorage(index,elem)},allDone(){this.todoArray.forEach(todo=>{todo.done=!0,todo.timeFin=this.setTime()}),"undefined"!=typeof Storage&&window.localStorage.setItem("todo-app",JSON.stringify(this.todoArray))},allDFalse(){this.todoArray.forEach(todo=>{todo.done=!1,todo.timeFin=""}),"undefined"!=typeof Storage&&window.localStorage.setItem("todo-app",JSON.stringify(this.todoArray))},counter(){return this.todoArray.filter(todo=>!1===todo.done).length},addToLocalStorage(index,elem){this.todoArray[index]&&(this.todoArray[index].done=elem.target.checked,this.todoArray[index].timeFin=this.todoArray[index].done?this.setTime():""),"undefined"!=typeof Storage&&window.localStorage.setItem("todo-app",JSON.stringify(this.todoArray))},setTime(){const options={hour:"2-digit",minute:"2-digit",hour12:!1};return(new Date).toLocaleDateString(this.lang,options)},counterNumbers(){const numArray=[];return this.todoArray.forEach(e=>{void 0===e.todo||e.done||isNaN(parseFloat(e.todo.match(/[+-]?((?=\.?\d)\d*\.?\d*)/g)))||numArray.push(parseFloat(e.todo.match(/[+-]?((?=\.?\d)\d*\.?\d*)/g)))}),numArray.reduce((a,b)=>{const n1=a.toString().split(".")[1],n2=b.toString().split(".")[1],len1=n1&&n1.length||0,len2=n2&&n2.length||0;return parseFloat((a+b).toFixed(len1+len2))},0)},clearLocalStorage(){window.localStorage.clear(),this.todoArray=[]},dialog(calback){this.$el.querySelector("#dialog").classList.remove("hidden"),this.$el.querySelector("#yes").onclick=()=>{calback(),this.hide("#dialog")},this.$el.querySelector("#no").onclick=()=>this.hide("#dialog")},removeAllChecked(){vm.todoArray=this.todoArray.filter(e=>void 0!==e.done&&!e.done).map(e=>e),this.addToLocalStorage()},edit(index){this.index=index,this.$el.querySelector("#editor").classList.remove("hidden"),this.$el.querySelector("#edit").value=this.todoArray[index].todo,this.$el.querySelector("#edit").focus()},save(){this.$el.querySelector("#edit").value.length>0&&this.todoArray[this.index].todo!==this.$el.querySelector("#edit").value&&(this.todoArray[this.index].todo=this.$el.querySelector("#edit").value,this.addToLocalStorage()),this.hide("#editor")},hide(elem){this.$el.querySelector(elem).classList.add("hidden")},refresh(){this.placeholder="Type here.."}},mounted(){this.todoArray="undefined"!=typeof Storage&&this.parser()||[],this.$el.querySelector("#adm").checked=!window.localStorage.getItem("safeMode"),this.$el.querySelector("#adm").addEventListener("change",e=>{e.currentTarget.checked?window.localStorage.removeItem("safeMode"):window.localStorage.setItem("safeMode",0)})},watch:{flag(){this.flag&&window.setTimeout(()=>document.getElementById("todo").focus({preventScroll:!0}),200),this.flag=!1}}});